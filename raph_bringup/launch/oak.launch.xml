<launch version="0.1.1">

  <node_container namespace=""
    name="oak_container"
    pkg="rclcpp_components"
    exec="component_container_isolated">
    <composable_node namespace=""
      name="oak"
      pkg="depthai_ros_driver"
      plugin="depthai_ros_driver::Camera">
      <extra_arg name="use_intra_process_comms" value="true" />
      <param from="$(find-pkg-share raph_bringup)/config/oak.yaml" />
      <!-- Remap left and right cameras to match physical orientation -->
      <remap from="oak/left/image_raw" to="oak/right/image_raw" />
      <remap from="oak/left/camera_info" to="oak/right/camera_info" />
      <remap from="oak/right/image_raw" to="oak/left/image_raw" />
      <remap from="oak/right/camera_info" to="oak/left/camera_info" />
    </composable_node>
    <composable_node namespace="oak"
      name="point_cloud_xyz"
      pkg="depth_image_proc"
      plugin="depth_image_proc::PointCloudXyzNode">
      <extra_arg name="use_intra_process_comms" value="true" />
      <remap from="image_rect" to="stereo/image_raw" />
      <remap from="camera_info" to="stereo/camera_info" />
    </composable_node>
    <composable_node namespace="oak/left"
      name="compressed_republisher"
      pkg="image_transport"
      plugin="image_transport::Republisher">
      <extra_arg name="use_intra_process_comms" value="true" />
      <param name="in_transport" value="raw" />
      <param name="out_transport" value="compressed" />
      <remap from="in" to="image_raw" />
      <remap from="out/compressed" to="image_raw/compressed" />
    </composable_node>
    <composable_node namespace="oak/rgb"
      name="compressed_republisher"
      pkg="image_transport"
      plugin="image_transport::Republisher">
      <extra_arg name="use_intra_process_comms" value="true" />
      <param name="in_transport" value="raw" />
      <param name="out_transport" value="compressed" />
      <remap from="in" to="image_raw" />
      <remap from="out/compressed" to="image_raw/compressed" />
    </composable_node>
    <composable_node namespace="oak/right"
      name="compressed_republisher"
      pkg="image_transport"
      plugin="image_transport::Republisher">
      <extra_arg name="use_intra_process_comms" value="true" />
      <param name="in_transport" value="raw" />
      <param name="out_transport" value="compressed" />
      <remap from="in" to="image_raw" />
      <remap from="out/compressed" to="image_raw/compressed" />
    </composable_node>
    <composable_node namespace="oak/stereo"
      name="compressed_republisher"
      pkg="image_transport"
      plugin="image_transport::Republisher">
      <extra_arg name="use_intra_process_comms" value="true" />
      <param name="in_transport" value="raw" />
      <param name="out_transport" value="compressedDepth" />
      <remap from="in" to="image_raw" />
      <remap from="out/compressedDepth" to="image_raw/compressedDepth" />
    </composable_node>
  </node_container>

</launch>